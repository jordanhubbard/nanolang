/* Test std::env module */

extern fn getenv(name: string) -> string
extern fn setenv(name: string, value: string, overwrite: int) -> int
extern fn unsetenv(name: string) -> int
extern fn get_argc() -> int
extern fn get_argv(index: int) -> string

fn test_getenv() -> int {
    (println "Testing getenv:")
    
    let mut path: string = ""
    unsafe {
        set path (getenv "PATH")
    }
    (print "  PATH length: ")
    (println (int_to_string (str_length path)))
    
    return 0
}

fn test_setenv() -> int {
    (println "Testing setenv/unsetenv:")
    
    let mut code: int = 0
    unsafe {
        set code (setenv "NANOLANG_TEST_VAR" "test_value" 1)
    }
    (print "  setenv returned: ")
    (println (int_to_string code))
    
    let mut val: string = ""
    unsafe {
        set val (getenv "NANOLANG_TEST_VAR")
    }
    (print "  Value: ")
    (println val)
    
    unsafe {
        set code (unsetenv "NANOLANG_TEST_VAR")
    }
    (print "  unsetenv returned: ")
    (println (int_to_string code))
    
    return 0
}

fn test_args() -> int {
    (println "Testing get_argc/get_argv:")
    
    let mut argc: int = 0
    unsafe {
        set argc (get_argc)
    }
    (print "  argc: ")
    (println (int_to_string argc))
    
    let mut i: int = 0
    while (and (< i argc) (< i 5)) {
        let mut arg: string = ""
        unsafe {
            set arg (get_argv i)
        }
        (print "  argv[")
        (print (int_to_string i))
        (print "]: ")
        (println arg)
        set i (+ i 1)
    }
    
    return 0
}

fn main() -> int {
    (println "=== Testing std::env ===")
    (println "")
    
    (test_getenv)
    (println "")
    
    (test_setenv)
    (println "")
    
    (test_args)
    (println "")
    
    (println "All tests passed!")
    return 0
}

shadow main {
    assert (== (main) 0)
}

