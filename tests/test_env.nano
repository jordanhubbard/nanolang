/* Test std::env module */

from "modules/std/env.nano" import get, set_env, unset, argc, argv

fn test_getenv() -> int {
    (println "Testing getenv:")
    
    let path: string = (get "PATH")
    (print "  PATH length: ")
    (println (int_to_string (str_length path)))
    
    return 0
}

shadow test_getenv {
    assert true
}

fn test_setenv() -> int {
    (println "Testing setenv/unsetenv:")
    
    let code: int = (set_env "NANOLANG_TEST_VAR" "test_value")
    (print "  setenv returned: ")
    (println (int_to_string code))
    
    let val: string = (get "NANOLANG_TEST_VAR")
    (print "  Value: ")
    (println val)
    
    let remove_code: int = (unset "NANOLANG_TEST_VAR")
    (print "  unsetenv returned: ")
    (println (int_to_string remove_code))
    
    return 0
}

shadow test_setenv {
    assert true
}

fn test_args() -> int {
    (println "Testing get_argc/get_argv:")
    
    let count: int = (argc)
    (print "  argc: ")
    (println (int_to_string count))
    
    let mut i: int = 0
    while (and (< i count) (< i 5)) {
        let arg: string = (argv i)
        (print "  argv[")
        (print (int_to_string i))
        (print "]: ")
        (println arg)
        set i (+ i 1)
    }
    
    return 0
}

shadow test_args {
    assert true
}

fn main() -> int {
    (println "=== Testing std::env ===")
    (println "")
    
    (test_getenv)
    (println "")
    
    (test_setenv)
    (println "")
    
    (test_args)
    (println "")
    
    (println "All tests passed!")
    return 0
}

shadow main {
    assert true
}

