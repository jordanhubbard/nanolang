# Regression test for for-loop segmentation fault
# Bug: Fixed on September 30, 2025
# Issue: NULL pointer dereference in type checker when accessing range function params
# Cause: Type checker didn't check if func->params was NULL before accessing
#
# This test ensures for-loops work correctly and don't cause segfaults

fn test_for_loop() -> int {
    let mut sum: int = 0
    
    for i in (range 1 11) {
        set sum (+ sum i)
    }
    
    return sum
}

shadow test_for_loop {
    # Sum of 1 to 10 = 55
    assert (== (test_for_loop) 55)
}

fn test_nested_for() -> int {
    let mut total: int = 0
    
    for i in (range 1 4) {
        for j in (range 1 4) {
            set total (+ total (* i j))
        }
    }
    
    return total
}

shadow test_nested_for {
    # (1*1 + 1*2 + 1*3) + (2*1 + 2*2 + 2*3) + (3*1 + 3*2 + 3*3)
    # = (1+2+3) + (2+4+6) + (3+6+9)
    # = 6 + 12 + 18 = 36
    assert (== (test_nested_for) 36)
}

fn main() -> int {
    print "For loop test: "
    print (test_for_loop)
    print "Nested for loop test: "
    print (test_nested_for)
    return 0
}

shadow main {
    assert (== (main) 0)
}

