# Test case for for-in-range scope bug (nanolang-frng)
# Loop variable should be accessible in nested contexts

fn test_nested_for_loops() -> int {
    let mut sum: int = 0
    
    # Triple nested for-in-range
    for i in (range 0 3) {
        for j in (range 0 3) {
            for k in (range 0 3) {
                # Bug: k not in scope here
                set sum (+ sum k)
            }
        }
    }
    
    return sum
}

shadow test_nested_for_loops {
    # 3 outer loops * 3 middle loops * (0+1+2) inner sum = 9 * 3 = 27
    assert (== (test_nested_for_loops) 27)
}

fn test_for_in_if_else() -> int {
    let arr: array<int> = [1, 2, 3, 4, 5]
    let len: int = (array_length arr)
    let mut count: int = 0
    
    if (< len 2) {
        return -1
    } else {
        # Bug: i not in scope inside this for loop
        for i in (range 1 len) {
            if (> (at arr i) 2) {
                set count (+ count 1)
            } else {
                (print "")
            }
        }
    }
    
    return count
}

shadow test_for_in_if_else {
    # Elements > 2: 3, 4, 5 = 3 elements
    assert (== (test_for_in_if_else) 3)
}

fn main() -> int {
    (println "Testing for-in-range scope bug...")
    let r1: int = (test_nested_for_loops)
    let r2: int = (test_for_in_if_else)
    (print "Results: ")
    (print r1)
    (print ", ")
    (println r2)
    return 0
}

shadow main {
    assert (== (main) 0)
}
