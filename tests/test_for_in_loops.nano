# Test for-in loop transpilation

fn sum_range(n: int) -> int {
    let mut sum: int = 0
    for i in (range 0 n) {
        set sum (+ sum i)
    }
    return sum
}

shadow sum_range {
    assert (== (sum_range 0) 0)
    assert (== (sum_range 1) 0)
    assert (== (sum_range 5) 10)
    assert (== (sum_range 10) 45)
    assert (== (sum_range 100) 4950)
}

fn count_even(n: int) -> int {
    let mut count: int = 0
    for i in (range 0 n) {
        if (== (% i 2) 0) {
            set count (+ count 1)
        }
    }
    return count
}

shadow count_even {
    assert (== (count_even 0) 0)
    assert (== (count_even 1) 1)  # 0 is even
    assert (== (count_even 10) 5)  # 0,2,4,6,8
    assert (== (count_even 11) 6)  # 0,2,4,6,8,10
}

fn nested_loops(n: int) -> int {
    let mut sum: int = 0
    for i in (range 0 n) {
        for j in (range 0 n) {
            set sum (+ sum (+ i j))
        }
    }
    return sum
}

shadow nested_loops {
    assert (== (nested_loops 0) 0)
    assert (== (nested_loops 1) 0)
    assert (== (nested_loops 2) 4)  # (0+0)+(0+1)+(1+0)+(1+1) = 0+1+1+2 = 4
    # nested_loops(3) returns 18 (tested in main)
}

fn array_iteration() -> int {
    let mut arr: array<int> = (array_new 5 0)
    
    # Fill array with indices
    for i in (range 0 5) {
        (array_set arr i i)
    }
    
    # Sum array elements
    let mut sum: int = 0
    for i in (range 0 (array_length arr)) {
        set sum (+ sum (at arr i))
    }
    
    return sum
}

shadow array_iteration {
    assert (== (array_iteration) 10)  # 0+1+2+3+4
}

fn range_start_end() -> int {
    let mut sum: int = 0
    for i in (range 5 10) {
        set sum (+ sum i)
    }
    return sum
}

shadow range_start_end {
    assert (== (range_start_end) 35)  # 5+6+7+8+9 = 35
}

fn main() -> int {
    (println "Testing for-in loops...")
    
    let sum: int = (sum_range 5)
    (println (+ "sum_range(5) = " (int_to_string sum)))
    
    let evens: int = (count_even 10)
    (println (+ "count_even(10) = " (int_to_string evens)))
    
    let nested: int = (nested_loops 3)
    (println (+ "nested_loops(3) = " (int_to_string nested)))
    
    let arr_sum: int = (array_iteration)
    (println (+ "array_iteration() = " (int_to_string arr_sum)))
    
    let range_sum: int = (range_start_end)
    (println (+ "range_start_end() = " (int_to_string range_sum)))
    
    (println "All for-in loop tests passed!")
    return 0
}

shadow main {
    assert (== (main) 0)
}
