/* User guide test: pattern logging trace and coverage instrumentation */
from "stdlib/log.nano" import log_info
from "stdlib/coverage.nano" import coverage_init, coverage_record, coverage_report
from "stdlib/coverage.nano" import trace_init, trace_record, trace_report

fn add_one(x: int) -> int {
    (trace_record "CALL" "add_one" (int_to_string x))
    (coverage_record "userguide" 1 1)
    return (+ x 1)
}

shadow add_one {
    assert (== (add_one 4) 5)
}

fn main() -> int {
    (coverage_init)
    (trace_init)
    (log_info "demo" "instrumentation demo")
    assert (== (add_one 9) 10)
    (coverage_report)
    (trace_report)
    return 0
}

shadow main { assert true }
