from "modules/std/json/json.nano" import Json, parse, free, get, object_has, as_string

fn extract_name(json_text: string) -> string {
    let root: Json = (parse json_text)
    if (== root 0) {
        return ""
    }
    if (not (object_has root "name")) {
        (free root)
        return ""
    }
    let v: Json = (get root "name")
    let out: string = (as_string v)
    (free v)
    (free root)
    return out
}

shadow extract_name {
    assert (str_equals (extract_name "{\"name\":\"nano\"}") "nano")
    assert (str_equals (extract_name "{\"x\":1}") "")
}

fn main() -> int {
    assert (str_equals (extract_name "{\"name\":\"NanoLang\"}") "NanoLang")
    return 0
}

shadow main { assert true }
