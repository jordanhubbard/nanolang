from "std/math/array_ops.nano" import array_sum, array_mean, array_min, array_max, array_sum_int

let EPS: float = 0.00001

fn approx(a: float, b: float) -> bool {
    return (< (abs (- a b)) EPS)
}

fn test_array_reductions() -> int {
    let a: array<float> = [1.0, 2.0, 4.0]
    assert (approx (array_sum a) 7.0)
    assert (approx (array_mean a) (/ 7.0 3.0))
    assert (approx (array_min a) 1.0)
    assert (approx (array_max a) 4.0)

    let ai: array<int> = [1, 2, 3]
    assert (== (array_sum_int ai) 6)
    return 0
}

shadow test_array_reductions {
    assert (== (test_array_reductions) 0)
}

fn test_array_elementwise_ops() -> int {
    let a: array<int> = [1, 2]
    let b: array<int> = [3, 4]

    let sum: array<int> = (+ a b)
    assert (== (at sum 0) 4)
    assert (== (at sum 1) 6)

    let inc: array<int> = (+ a 1)
    assert (== (at inc 0) 2)
    assert (== (at inc 1) 3)

    let rsub: array<int> = (- 10 a)
    assert (== (at rsub 0) 9)
    assert (== (at rsub 1) 8)
    return 0
}

shadow test_array_elementwise_ops {
    assert (== (test_array_elementwise_ops) 0)
}

fn main() -> int { return 0 }

shadow main {
    assert (== (main) 0)
}
