/* nl_functions_filter.nano - filter() builtin tests
 * Category: Core Language - Functions
 */

fn is_even(x: int) -> bool {
    return (== (% x 2) 0)
}

shadow is_even {
    assert (is_even 0)
    assert (is_even 2)
    assert (not (is_even 1))
}

fn double(x: int) -> int {
    return (* x 2)
}

shadow double {
    assert (== (double 5) 10)
}

fn add(a: int, b: int) -> int {
    return (+ a b)
}

shadow add {
    assert (== (add 2 3) 5)
}

fn filter_basic() -> array<int> {
    let nums: array<int> = [1, 2, 3, 4, 5, 6]
    return (filter nums is_even)
}

shadow filter_basic {
    let evens: array<int> = (filter_basic)
    assert (== (array_length evens) 3)
    assert (== (at evens 0) 2)
    assert (== (at evens 1) 4)
    assert (== (at evens 2) 6)
}

fn filter_empty_returns_empty() -> int {
    let nums: array<int> = (array_new 0 0)
    let evens: array<int> = (filter nums is_even)
    return (array_length evens)
}

shadow filter_empty_returns_empty {
    assert (== (filter_empty_returns_empty) 0)
}

fn pipeline_filter_map_reduce() -> int {
    let nums: array<int> = [1, 2, 3, 4]
    let evens: array<int> = (filter nums is_even)
    let doubled: array<int> = (map evens double)
    return (reduce doubled 0 add)
}

shadow pipeline_filter_map_reduce {
    assert (== (pipeline_filter_map_reduce) 12)
}

fn main() -> int {
    (println "nl_functions_filter: All filter tests passed!")
    return 0
}

shadow main {
    assert (== (main) 0)
}
